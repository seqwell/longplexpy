name: Trigger Version Bump

permissions:
  pull-requests: write
  contents: write

on:
  workflow_dispatch:
    inputs:
      version:
        description: Version to be applied. Must be greater than current version.
        required: true
        type: string
  push:
    branches:
      - zn_versioning # TODO: Remove on push trigger

jobs:
  update_version:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          ref: main
          fetch-tags: true
          fetch-depth: 0

      - name: Update pyproject.toml, commit
        id: update-version
        # TODO: Switch version from 9.9.9 to ${{ inputs.version }}
        run: |
          PR_BRANCH=ci_release_branch_$(date +"%Y%d%m.%H%M%S")
          git checkout -b ${PR_BRANCH}
          ci/update-version -v 9.9.9 -c
          echo "PR_BRANCH=${PR_BRANCH}" >> ${GITHUB_OUTPUT}
      
      - name: Push and Open Pull Request
        # TODO: Switch base from zn_versioning to main
        run: |
          git push --set-upstream origin ${{ steps.update-version.outputs.PR_BRANCH }}
          gh pr create \
            --base zn_versioning \
            --head ${{ steps.update-version.outputs.PR_BRANCH }} \
            --title "$(git log -1 --pretty=%B)" \
            --body "Update version in pyproject.toml to trigger release."
